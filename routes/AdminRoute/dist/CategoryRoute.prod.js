"use strict";var connection=require("./../../config"),express=require("express"),router=express.Router(),fs=require("fs"),tempimg="";router.get("/",function(e,o){connection.query("SELECT * FROM CategoryTbl",function(e,t,r){var a;e&&(a={success:"false",status:404,data:e}),t&&(a={flag:0,success:"true",status:200,data:t,message:"Redirected"}),o.render("category",{op:a})})}),router.post("/add",function(r,a){var t,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.files.categoryImage,o=Date.now()+r.files.categoryImage.name,e.next=4,regeneratorRuntime.awrap(t.mv("./public/images/category/"+o,function(e){var t;e?(console.log(e),error):(t=[r.body.txtCategoryName,o],connection.query("INSERT INTO CategoryTbl(CategoryName,Img) VALUES(?,?)",t,function(e,t,r){a.redirect("/category")}))}));case 4:case"end":return e.stop()}})}),router.get("/edit/:id",function(e,o){var t=e.params.id;connection.query("SELECT * FROM CategoryTbl WHERE CategoryId = ?",[t],function(e,t,r){var a;a=e?{success:"false",status:404,data:e}:0<t.length?{flag:1,success:"true",status:200,data:t,message:"Redirected"}:{flag:0,success:"false",status:200,data:t,message:"Category Not Available"},tempimg=a.data[0].Img,o.render("category",{op:a})})}),router.post("/edit",function(t,a){var r,o,n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.body.txtCategoryName,o=t.body.txtCategoryId,n="",t.files?(imgfile=t.files.categoryImage,fname=Date.now()+t.files.categoryImage.name,s="./public/images/category/"+tempimg,fs.unlink(s,function(e){e?a.send("error file remove"):imgfile.mv("./public/images/category/"+fname,function(e){e?console.log(e):(console.log("File deleted"),n="UPDATE CategoryTbl SET CategoryName = ?, Img = ? WHERE CategoryId = ?",connection.query(n,[r,fname,o],function(e,t,r){a.redirect("/category")}))})})):(console.log("File not found"),n="UPDATE CategoryTbl SET CategoryName = ? WHERE CategoryId = ?",connection.query(n,[r,o],function(e,t,r){a.redirect("/category")}));case 4:case"end":return e.stop()}})}),module.exports=router;